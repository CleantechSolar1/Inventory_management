{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>Post Expense</h2>
    <form method="POST" action="{{ url_for('main.add_expense') }}">
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label for="category">Category</label>
                    <select class="form-control" id="category" name="category" required>
                        <option value="">Select</option>
                        <option value="hardware">Hardware</option>
                        <option value="software">Software</option>
                        <option value="bills">Bills</option>
                        <option value="others">Others</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="sub_category">Sub Category</label>
                    <select class="form-control" id="sub_category" name="sub_category" required>
                        <option value="">Select category first</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="payment_date">Payment Date</label>
                    <input type="date" class="form-control" id="payment_date" name="payment_date" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="invoice_date">Invoice Date</label>
                    <input type="date" class="form-control" id="invoice_date" name="invoice_date" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="invoice_month">Invoice Month</label>
                    <input type="number" min="1" max="12" class="form-control" id="invoice_month" name="invoice_month" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="invoice_year">Invoice Year</label>
                    <input type="number" min="2000" class="form-control" id="invoice_year" name="invoice_year" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="vendor">Vendor</label>
                    <input type="text" class="form-control" id="vendor" name="vendor" list="vendor_list" autocomplete="off" required>
                    <datalist id="vendor_list">
                        {% for vendor in vendors %}
                        <option value="{{ vendor.name }}"></option>
                        {% endfor %}
                    </datalist>
                    <small class="form-text text-muted">Pick from pre-added vendors. Missing vendor? <a href="{{ url_for('main.expense_vendors') }}">Add Vendor</a>.</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="cleantech_entity">Cleantech Entity</label>
                    <input type="text" class="form-control" id="cleantech_entity" name="cleantech_entity" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="currency">Currency</label>
                    <select class="form-control" id="currency" name="currency" required>
                        <option value="">Select</option>
                        <option value="INR">INR</option>
                        <option value="USD">USD</option>
                        <option value="IDR">IDR</option>
                        <option value="SGD">SGD</option>
                        <option value="THB">THB</option>
                        <option value="MYR">MYR</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" step="0.01" class="form-control" id="amount" name="amount" required>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="amount_usd">Amount (USD)</label>
                    <input type="number" step="0.01" class="form-control" id="amount_usd" name="amount_usd">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="payment_mode">Payment Mode</label>
                    <select class="form-control" id="payment_mode" name="payment_mode" required>
                        <option value="">Select</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="UPI">UPI</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Cash">Cash</option>
                        <option value="Cheque">Cheque</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="remarks">Remarks</label>
                    <textarea class="form-control" id="remarks" name="remarks" rows="2"></textarea>
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Post Invoice</button>
        <a href="{{ url_for('main.expenses') }}" class="btn btn-secondary mt-3">Back</a>
    </form>
</div>
<script>
    (function () {
        const categorySelect = document.getElementById('category');
        const subCategorySelect = document.getElementById('sub_category');
        const mapping = {
            hardware: ['Laptop', 'Monitor', 'TV', 'Cable', 'Remote', 'Charger', 'Connector', 'Earphones'],
            software: ['License', 'Domains'],
            bills: ['WIFI bills', 'Others'],
            others: ['Bags' ,'Others']
        };

        function fillSubCategories() {
            const category = categorySelect.value;
            const options = mapping[category] || [];
            subCategorySelect.innerHTML = '';
            if (!options.length) {
                const opt = document.createElement('option');
                opt.value = '';
                opt.textContent = 'Select category first';
                subCategorySelect.appendChild(opt);
                return;
            }
            const defaultOpt = document.createElement('option');
            defaultOpt.value = '';
            defaultOpt.textContent = 'Select';
            subCategorySelect.appendChild(defaultOpt);
            options.forEach(function (value) {
                const opt = document.createElement('option');
                opt.value = value;
                opt.textContent = value;
                subCategorySelect.appendChild(opt);
            });
        }

        categorySelect.addEventListener('change', fillSubCategories);
        fillSubCategories();
    })();
</script>
{% endblock %}
